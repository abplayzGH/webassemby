<!DOCTYPE html>

<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Memory</title>
</head>

<body>
    <h2>Hello, WebAssembly!</h2>

    <script>
        var memory = new WebAssembly.Memory({
            initial: 256,
            maximum: 512
        });

        var exports;
        WebAssembly.instantiateStreaming(fetch("main.wasm"), {
            js: {
                mem: memory
            }
        }).then(results => {
            exports = results.instance.exports;
            memory = results.instance.exports.memory;
        });

        function run_wasm() {
            var arr = new Uint32Array(memory.buffer);
            for (var i = 0; i < 10; i++) {
                arr[i] = i * 2;
            }

            var sum = exports.accumulate(0, 10);

            document.querySelector("#ret")
                .innerHTML += `${sum}<br>`;
        }
    </script>

    <input type="number" id="a">
    <button onclick="run_wasm()">Trigger</button>
    <p id="ret"></p>

</body>

</html>